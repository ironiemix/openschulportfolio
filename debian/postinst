#!/bin/sh -e

DATADIR="/home/linuxmuster-portfolio/data/"
EXAMPLES="/var/lib/linuxmuster-portfolio/example_data/"


if [ ! -f $DATADIR/DELETEME_FOR_FRESH_EXAMPLES ]; then
   cp -r $EXAMPLES/*  $DATADIR/
fi

# Permissions of data dir: must be writable for www-data
if [ -d /home/linuxmuster-portfolio/data ]; then
    chown -R www-data: /home/linuxmuster-portfolio/data 
fi

if [ -f /usr/share/linuxmuster/config/dist.conf ]; then  
     . /usr/share/linuxmuster/config/dist.conf
fi

basedn=`grep basedn $NETWORKSETTINGS | sed "s/^.*\"\(.*\)\".*$/\1/"`

sed -i'' -e"s/\(ou=accounts,\).*;/\1 $basedn\';/" /etc/linuxmuster-portfolio/local.php
sed -i'' -e"s/\(ou=groups,\).*;/\1 $basedn\';/" /etc/linuxmuster-portfolio/local.php

